create or replace PROCEDURE HRIS_MIG_BRANCH
AS
V_BRANCH_ID NUMBER;
V_STATUS CHAR(1 BYTE);
BEGIN
FOR V_BRANCH_LIST IN (SELECT REGEXP_SUBSTR (BRANCH_CODE, '[^.]+', 1, 1)    AS BRANCH_CODE_1,
REGEXP_SUBSTR (BRANCH_CODE, '[^.]+', 1, 2)    AS BRANCH_CODE_2,
BRANCH_CODE,BRANCH_EDESC,ADDRESS,TELEPHONE_NO,EMAIL,PRE_BRANCH_CODE,GROUP_SKU_FLAG,REMARKS,COMPANY_CODE,DELETED_FLAG
FROM  FA_BRANCH_SETUP WHERE GROUP_SKU_FLAG='I')
LOOP



BEGIN
SELECT BRANCH_ID INTO V_BRANCH_ID FROM HRIS_BRANCHES WHERE BRANCH_ID=V_BRANCH_LIST.BRANCH_CODE_2;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
BEGIN

IF(V_BRANCH_LIST.DELETED_FLAG='N') THEN
V_STATUS:='E';
ELSE
V_STATUS:='D';
END IF;

INSERT INTO HRIS_BRANCHES
(BRANCH_ID,
BRANCH_CODE,
BRANCH_NAME,
STREET_ADDRESS,
TELEPHONE,
CREATED_DT,
STATUS,
COMPANY_ID)
VALUES
(V_BRANCH_LIST.BRANCH_CODE_2,
V_BRANCH_LIST.BRANCH_CODE,
V_BRANCH_LIST.BRANCH_EDESC,
V_BRANCH_LIST.ADDRESS,
V_BRANCH_LIST.TELEPHONE_NO,
TRUNC(SYSDATE),
V_STATUS,
V_BRANCH_LIST.COMPANY_CODE
);






END;

END;





END LOOP;
END;